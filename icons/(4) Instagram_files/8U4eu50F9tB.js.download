;/*FB_PKG_DELIM*/

__d("MAWMediaDownloadStatusBackendFetcher",["I64","LSAuthorityLevel","LSIntEnum","MAWBridgeSendAndReceive","MAWDbMedia","MAWMediaSetClientMediaStatus","MessagingAttachmentType","ODS","WAHashUtils","isReceiverFetchSticker","promiseDone","react","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(h||d("react")).useEffect,m=new Set();function a(a){var b=a.attachment,d=a.mediaRenderQpl,e=a.mediaStatus,f=a.statusKey,g=c("useAsyncReStore")();l(function(){n(b,d,e,f,g)},[g,b,d,e,f])}function b(a){var b=c("useAsyncReStore")();l(function(){a.forEach(function(a){var c=a.attachment,d=a.mediaRenderQpl,e=a.mediaStatus;a=a.statusKey;n(c,d,e,a,b,!0)})},[b,a])}function n(a,b,e,f,g,h){h===void 0&&(h=!1);if(a==null||f==null)return;var l=c("isReceiverFetchSticker")(a),n=(i||(i=d("I64"))).equal(a.attachmentType,(j||(j=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA)),o=a.transportKey==="FBBroker"||a.transportKey==="FBLegacyBroker";a=!o&&(i||(i=d("I64"))).to_int32(a.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;e=e!=null;n=n||a||o||l||e||m.has(f);(k||(k=d("ODS"))).bumpEntityKey(3185,"media_initial_download_status",(h?"bulk":"single")+"."+(n?"skip":"request"));if(n){b==null||b.addPoint("skip_fetch_download_status");return}b==null||b.addPoint("request_download_status");m.add(f);a=isNaN(f);o=a?d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByPlaintextHash",{plaintextHash:d("WAHashUtils").stringToPlaintextHash(f),qplInstanceKey:b==null?void 0:b.getInstanceKey()}):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMediaDownloadStatusByMediaId",{mediaId:d("MAWDbMedia").convertNumberToMediaId(parseInt(f,10)),qplInstanceKey:b==null?void 0:b.getInstanceKey()});c("promiseDone")(o.then(function(a){a!=null&&d("MAWMediaSetClientMediaStatus").call(g,f,a)}))}g.useFetchInitialDownloadStatus=a;g.useFetchInitialDownloadStatusBulk=b}),98);